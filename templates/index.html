<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ðŸŽµ Music Mood Predictor</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
  <div class="container">
    <h1>ðŸŽ¶ Music Mood Predictor</h1>
    <p class="tagline">Enter your song lyrics and let AI feel the vibe ðŸŽ§</p>

    <!-- Lyrics Form -->
    <form id="lyricsForm" action="/predict" method="POST">
      <textarea id="lyricsInput" name="lyrics" placeholder="Type or paste your song lyrics here...">{{ lyrics if lyrics else '' }}</textarea>

      <div class="button-row">
        <button id="predictBtn" type="submit">Predict Mood</button>
        <button type="button" id="clearBtn" class="secondary">Clear</button>
        <button type="button" id="demoBtn" class="secondary">Demo Lyrics</button>
      </div>
    </form>

    <!-- Loading Animation -->
    <div id="loading" class="loading hidden">
      <div class="spinner"></div>
      <p>Analyzing lyrics...</p>
    </div>

    <!-- Prediction Output -->
    {% if prediction %}
    <div id="resultBox" class="result {{ prediction|lower }}">
      <h2>Predicted Mood ðŸŽ§</h2>
      <p class="mood-text">{{ prediction }}</p>
      <p class="mood-desc">
        {% if prediction.lower() == "happy" %}
          A bright and upbeat vibe â€” your song radiates positivity! ðŸŒž
        {% elif prediction.lower() == "sad" %}
          The lyrics carry emotion and depth â€” a heartfelt melody. ðŸ’”
        {% elif prediction.lower() == "angry" %}
          Intense and passionate energy â€” pure power in every word! ðŸ”¥
        {% elif prediction.lower() == "relaxed" %}
          Smooth and soothing â€” perfect for chill vibes ðŸŒ™
        {% else %}
          A unique emotional blend â€” beautifully complex. ðŸŽ¶
        {% endif %}
      </p>
      <button type="button" id="saveBtn" class="secondary">ðŸ’¾ Save Prediction</button>
    </div>
    {% endif %}

    {% if error %}
    <div class="error">
      <p>{{ error }}</p>
    </div>
    {% endif %}
  </div>

  <footer>Made with ðŸ’œ by Krina</footer>

  <!-- Script Section -->
  <script>
    const form = document.getElementById("lyricsForm");
    const loading = document.getElementById("loading");
    const lyricsInput = document.getElementById("lyricsInput");
    const clearBtn = document.getElementById("clearBtn");
    const demoBtn = document.getElementById("demoBtn");
    const saveBtn = document.getElementById("saveBtn");
    const predictBtn = document.getElementById("predictBtn");

    const demoLyricsList = [
      "Dancing through the fire, I keep rising higher ðŸ”¥",
      "Raindrops on my window, but I feel warm inside â˜”",
      "My heart beats louder when I see your face â¤ï¸",
      "The world slows down when the stars light up ðŸŒŒ",
      "Lost in my thoughts, but I find peace in sound ðŸŽ§",
      "'Cause, darling, I'm a nightmare dressed like a daydream ðŸ˜Ž",
      "I knew I'd curse you for the longest time / Chasing shadows in the grocery line ðŸ›’"
    ];

    // Show spinner while analyzing
    form.addEventListener("submit", () => {
      loading.classList.remove("hidden");
    });

    // Clear lyrics and prediction
    clearBtn.addEventListener("click", () => {
      lyricsInput.value = "";
      const resultBox = document.querySelector(".result");
      const errorBox = document.querySelector(".error");
      if (resultBox) {
        resultBox.style.opacity = "0";
        setTimeout(() => (resultBox.style.display = "none"), 300);
      }
      if (errorBox) {
        errorBox.style.opacity = "0";
        setTimeout(() => (errorBox.style.display = "none"), 300);
      }
      loading.classList.add("hidden");
    });

    // Demo lyrics randomizer
    demoBtn.addEventListener("click", () => {
      const random = Math.floor(Math.random() * demoLyricsList.length);
      lyricsInput.value = demoLyricsList[random];
    });

    // Save prediction to a file
    if (saveBtn) {
      saveBtn.addEventListener("click", () => {
        const mood = document.querySelector(".mood-text")?.innerText || "Unknown Mood";
        const lyrics = lyricsInput.value || "No lyrics provided";
        const blob = new Blob([`Lyrics:\n${lyrics}\n\nPredicted Mood: ${mood}`], { type: "text/plain" });
        const link = document.createElement("a");
        link.href = URL.createObjectURL(blob);
        link.download = "mood_prediction.txt";
        link.click();
      });
    }

    // Hide prediction when typing new lyrics
    lyricsInput.addEventListener("input", () => {
      const resultBox = document.querySelector(".result");
      if (resultBox) {
        resultBox.style.opacity = "0";
        setTimeout(() => (resultBox.style.display = "none"), 300);
      }
    });

    // Scroll result into view automatically
    window.addEventListener("load", () => {
      const resultBox = document.getElementById("resultBox");
      if (resultBox) {
        resultBox.scrollIntoView({ behavior: "smooth", block: "center" });
      }
    });

    // Submit form when pressing Enter (without Shift)
    lyricsInput.addEventListener("keydown", (e) => {
      if (e.key === "Enter" && !e.shiftKey) {
        e.preventDefault();
        predictBtn.click();
      }
    });

    // ðŸ”¥ Arrow keys behave like Tab / Shift+Tab navigation
    const focusableElements = Array.from(document.querySelectorAll("textarea, button"));
    let currentIndex = 0;

    document.addEventListener("keydown", (e) => {
      if (["ArrowRight", "ArrowDown"].includes(e.key)) {
        e.preventDefault();
        currentIndex = (currentIndex + 1) % focusableElements.length;
        focusableElements[currentIndex].focus();
      } else if (["ArrowLeft", "ArrowUp"].includes(e.key)) {
        e.preventDefault();
        currentIndex = (currentIndex - 1 + focusableElements.length) % focusableElements.length;
        focusableElements[currentIndex].focus();
      } else if (e.key === "Enter" && document.activeElement.tagName === "BUTTON") {
        document.activeElement.click();
      }
    });

    // Add focus styling
    focusableElements.forEach(el => {
      el.addEventListener("focus", () => {
        focusableElements.forEach(f => f.classList.remove("focused"));
        el.classList.add("focused");
      });
    });
  </script>
</body>
</html>

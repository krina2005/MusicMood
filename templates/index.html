<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ğŸµ Music Mood Predictor</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}?v={{ range(1, 9999) | random }}">
</head>
<body>
  <div class="container">
    <div class="header-section">
      <h1>ğŸ¶ Music Mood Predictor</h1>
      <p class="tagline">Enter your song lyrics and let AI feel the vibe ğŸ§</p>
    </div>

    <form id="lyricsForm" action="/predict" method="POST">
      <div class="form-group">
        <textarea 
          id="lyricsInput" 
          name="lyrics" 
          placeholder="Type or paste your song lyrics here..." 
          spellcheck="true"
          required
        ></textarea>
      </div>

      <div class="button-row">
        <button id="predictBtn" type="submit" class="btn-primary">Predict Mood</button>
        <button type="button" id="clearBtn" class="btn-secondary">Clear</button>
        <button type="button" id="demoBtn" class="btn-secondary">Demo Lyrics</button>
      </div>
    </form>

    <!-- Loading Animation -->
    <div id="loading" class="loading hidden">
      <div class="spinner"></div>
      <p>Analyzing lyrics...</p>
    </div>

    <!-- Prediction Output -->
    {% if prediction %}
    <div class="result">
      <h2>Predicted Mood ğŸ§</h2>
      <p class="mood-text">{{ prediction }}</p>
      <p class="mood-desc">
        {% if prediction.lower() == "happy" %}
          ğŸŒ A bright and upbeat vibe â€” your song radiates positivity!
        {% elif prediction.lower() == "sad" %}
          ğŸ’” The lyrics carry emotion and depth â€” a heartfelt melody.
        {% elif prediction.lower() == "angry" %}
          ğŸ”¥ Intense and passionate energy â€” pure power in every word!
        {% elif prediction.lower() == "relaxed" %}
          ğŸŒ™ Smooth and soothing â€” perfect for chill vibes
        {% else %}
          ğŸ¶ A unique emotional blend â€” beautifully complex.
        {% endif %}
      </p>
      <button type="button" id="saveBtn" class="btn-save">ğŸ’¾ Save Prediction</button>
    </div>
    {% endif %}

    {% if error %}
    <div class="error-box">
      <p>âš ï¸ {{ error }}</p>
    </div>
    {% endif %}
  </div>

  <footer>Made with ğŸ’œ by Krina</footer>

  <script>
    const form = document.getElementById("lyricsForm");
    const loading = document.getElementById("loading");
    const lyricsInput = document.getElementById("lyricsInput");
    const clearBtn = document.getElementById("clearBtn");
    const demoBtn = document.getElementById("demoBtn");
    const predictBtn = document.getElementById("predictBtn");
    const resultBox = document.querySelector(".result");
    const errorBox = document.querySelector(".error-box");

    const demoLyricsList = [
      "Dancing through the fire, I keep rising higher ğŸ”¥",
      "Raindrops on my window, but I feel warm inside â˜”",
      "My heart beats louder when I see your face â¤ï¸",
      "The world slows down when the stars light up ğŸŒŒ",
      "Lost in my thoughts, but I find peace in sound ğŸ§",
      "'Cause, darling, I'm a nightmare dressed like a daydream ğŸ˜",
      "I knew I'd curse you for the longest time / Chasing shadows in the grocery line ğŸ›’"
    ];

    // Show loading spinner on form submit
    form.addEventListener("submit", () => {
      loading.classList.remove("hidden");
      if (resultBox) resultBox.style.display = "none";
      if (errorBox) errorBox.style.display = "none";
    });

    // Clear button functionality
    clearBtn.addEventListener("click", () => {
      lyricsInput.value = "";
      if (resultBox) {
        resultBox.style.opacity = "0";
        setTimeout(() => (resultBox.style.display = "none"), 300);
      }
      if (errorBox) {
        errorBox.style.opacity = "0";
        setTimeout(() => (errorBox.style.display = "none"), 300);
      }
      loading.classList.add("hidden");
      lyricsInput.focus();
    });

    // Demo lyrics randomizer
    demoBtn.addEventListener("click", () => {
      const random = Math.floor(Math.random() * demoLyricsList.length);
      lyricsInput.value = demoLyricsList[random];
      lyricsInput.focus();
    });

    // Save prediction to file
    const saveBtn = document.getElementById("saveBtn");
    if (saveBtn) {
      saveBtn.addEventListener("click", () => {
        const mood = document.querySelector(".mood-text")?.innerText || "Unknown Mood";
        const lyrics = lyricsInput.value || "No lyrics provided";
        const blob = new Blob([`Lyrics:\n${lyrics}\n\nPredicted Mood: ${mood}`], { type: "text/plain" });
        const link = document.createElement("a");
        link.href = URL.createObjectURL(blob);
        link.download = "mood_prediction.txt";
        link.click();
      });
    }

    // Hide prediction when typing new lyrics
    lyricsInput.addEventListener("input", () => {
      if (resultBox) {
        resultBox.style.opacity = "0";
        setTimeout(() => (resultBox.style.display = "none"), 300);
      }
      if (errorBox) {
        errorBox.style.opacity = "0";
        setTimeout(() => (errorBox.style.display = "none"), 300);
      }
    });

    // Scroll result into view automatically
    window.addEventListener("load", () => {
      const resultBox = document.querySelector(".result");
      if (resultBox) {
        setTimeout(() => resultBox.scrollIntoView({ behavior: "smooth", block: "center" }), 300);
      }
    });

    // Submit form when pressing Enter (without Shift)
    lyricsInput.addEventListener("keydown", (e) => {
      if (e.key === "Enter" && !e.shiftKey) {
        e.preventDefault();
        predictBtn.click();
      }
    });

    // Arrow keys navigation
    const focusableElements = Array.from(document.querySelectorAll("textarea, button"));
    let currentIndex = 0;

    document.addEventListener("keydown", (e) => {
      if (["ArrowRight", "ArrowDown"].includes(e.key)) {
        e.preventDefault();
        currentIndex = (currentIndex + 1) % focusableElements.length;
        focusableElements[currentIndex].focus();
      } else if (["ArrowLeft", "ArrowUp"].includes(e.key)) {
        e.preventDefault();
        currentIndex = (currentIndex - 1 + focusableElements.length) % focusableElements.length;
        focusableElements[currentIndex].focus();
      }
    });

    // Focus styling
    focusableElements.forEach((el, idx) => {
      el.addEventListener("focus", () => {
        focusableElements.forEach(f => f.classList.remove("focused"));
        el.classList.add("focused");
        currentIndex = idx;
      });
    });
  </script>
</body>
</html>